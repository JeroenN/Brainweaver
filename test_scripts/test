 #!/bin/bash

# From the documentation:
# For example, to include line numbers for a assertEquals() 
# function call, replace the assertEquals() with ${_ASSERT_EQUALS_}.


# Prerequisite scripts
cd ../../testing_cpp_gui_applications_tutorial/scripts
. ./get_dialog_id_by_title
. ./close_first_dialog_by_title

# Go back
cd ../../Brainweaver/test_scripts

# Brainweaver scripts
. ./close_assessor_menu
. ./close_developer_menu
. ./find_assessor_menu
. ./find_developer_menu
. ./goto_assessor_menu
. ./goto_developer_menu
. ./start_brainweaver

# The first screen
test_start_brainweaver()
{
  # echo "Developer start menu must initially be absent"
  id=`get_dialog_id_by_title 'Menu voor de ontwikkelaar'`
  if [ $id ]; then
    fail "Absent dialog must not have an ID"
    return
  fi

  # echo "Create developer start menu"
  start_brainweaver
  sleep 1
  id=`get_dialog_id_by_title 'Menu voor de ontwikkelaar'`
  if [ ! $id ]; then
    fail "Developer main menu cannot be found"
    return
  fi

  # echo "Close developer start menu"
  xdotool windowactivate $id sleep 0.2 key Escape sleep 1.0

  # Should be absent again
  id=`get_dialog_id_by_title 'Menu voor de ontwikkelaar'`
  #${_ASSERT_NULL_} "$id"
  if [ $id ]; then
    fail "Closed dialog must not have an ID"
  fi
}

test_close_developer_menu()
{
  # echo "Developer start menu must initially be absent"
  id=`get_dialog_id_by_title 'Menu voor de ontwikkelaar'`
  if [ $id ]; then
    fail "Absent dialog must not have an ID"
    return
  fi

  # echo "Create developer start menu"
  start_brainweaver
  sleep 1
  id=`get_dialog_id_by_title 'Menu voor de ontwikkelaar'`
  if [ ! $id ]; then
    fail "Developer main menu cannot be found"
    return
  fi

  close_developer_menu
  sleep 1

  # Should be closed
  id=`get_dialog_id_by_title 'Menu voor de ontwikkelaar'`
  #${_ASSERT_NULL_} "$id"
  if [ $id ]; then
    fail "Developer main menu has not been closed"
  fi
}

test_find_developer_menu()
{
  # echo "Developer start menu must initially be absent"
  id=`find_developer_menu`
  if [ $id ]; then
    fail "Absent dialog must not have an ID"
    return
  fi

  # echo "Create developer start menu"
  start_brainweaver
  sleep 1
  id=`find_developer_menu`
  if [ ! $id ]; then
    fail "Developer menu cannot be found"
    return
  fi

  # echo "Close developer menu"
  close_developer_menu

  # Should be absent again
  id=`find_developer_menu`
  #${_ASSERT_NULL_} "$id"
  if [ $id ]; then
    fail "Closed dialog must not have an ID"
  fi
}


test_goto_developer_menu()
{
   # echo "Developer start menu must initially be absent"
  id=`find_developer_menu`
  if [ $id ]; then
    fail "Absent dialog must not have an ID"
    return
  fi

  # echo "Create developer start menu"
  goto_developer_menu
  sleep 1

  id=`find_developer_menu`
  if [ ! $id ]; then
    fail "Developer menu cannot be found"
    return
  fi

  # echo "Close developer menu"
  close_developer_menu

  # Should be absent again
  id=`find_developer_menu`
  #${_ASSERT_NULL_} "$id"
  if [ $id ]; then
    fail "Closed dialog must not have an ID"
  fi
}

test_goto_assessor_menu()
{
  # echo "Assessor start menu dialog must initially be absent"
  id=`get_dialog_id_by_title 'Mijn persoonlijke werktheorie, programma voor de assessor'`

  #${_ASSERT_NULL_} "$id"
  if [ $id ]; then
    fail "Absent dialog must not have an ID"
    return
  fi

  # echo "Creating assessor start menu dialog"
  goto_assessor_menu
  sleep 1

  # echo "Assessor start menu dialog should be present now"
  id=`get_dialog_id_by_title 'Mijn persoonlijke werktheorie, programma voor de assessor'`
  if [ ! $id ]; then
    fail "Could not find create assessor start menu dialog"
    return
  fi

  # echo "Close assessor start menu dialog"
  xdotool windowactivate $id sleep 0.2 key Escape sleep 1.0

  # echo "Close developer main menu dialog"
  id=`get_dialog_id_by_title 'Menu voor de ontwikkelaar'`
  if [ ! $id ]; then
    fail "Could not find developer main menu dialog"
  fi
  xdotool windowactivate $id sleep 0.2 key Escape sleep 1.0
}

test_find_assessor_menu()
{
  # echo "Assessor start menu must initially be absent"
  id=`find_assessor_menu`
  if [ $id ]; then
    fail "Absent dialog must not have an ID"
    return
  fi

  # echo "Create Assessor start menu"
  goto_assessor_menu
  sleep 1
  id=`find_assessor_menu`
  if [ ! $id ]; then
    fail "Assessor start menu cannot be found"
    return
  fi

  # echo "Close assessor start menu"
  close_assessor_menu

  # Should be absent again
  id=`find_assessor_menu`
  #${_ASSERT_NULL_} "$id"
  if [ $id ]; then
    fail "Closed dialog must not have an ID"
  fi
}


# load shunit2
. ../../shunit2/source/2.1/src/shunit2